<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.ico" sizes="32x32" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <title>Оформление заказа</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script>
        (function() {
            emailjs.init({
                publicKey: 'KpP14eaDkxeADVeWy' // Замените на ваш Public Key
            });
        })();
    </script>
</head>
<body>
    <a class="dop" href="cart.html">Подробнее</a>
    <h1>Xomak`s Games</h1>
    <h2><div id="bal"></div></h2>
    <div class="counter">
        <form id="message-form">
            <div class="cont1">
                <input minlength="3" maxlength="10" name="name" placeholder="Введите ваше имя" type="text" required>
                <input name="email" placeholder="Введите ваш email" type="email" required>
                <input title="Например +7-123-456-78-90" minlength="16" maxlength="16" type="tel" name="tel" placeholder="Введите ваш номер телефона" pattern="[+]{1}[7]{1}[-]{1}[0-9]{3}[-]{1}[0-9]{3}[-]{1}[0-9]{2}[-]{1}[0-9]{2}" required>
                <select name="tovar" id="tovar" autofocus>
                    <option selected disabled>-- Выберите товар --</option>
                    <option value="Nintendo Switch Lite">Nintendo Switch Lite</option>
                    <option value="PlayStation 5 Slim">PlayStation 5 Slim</option>
                    <option value="PlayStation 4 Pro">PlayStation 4 Pro</option>
                    <option value="Фигурку Funko POP! Disney Donald Duck">Фигурка Funko POP! Disney Donald Duck</option>
                    <option value="Фигурку Funko POP! TV Invincible Omni-Man">Фигурка Funko POP! TV Invincible Omni-Man</option>
                    <option value="Фигурку Funko POP! Animation One Piece Katakuri">Фигурка Funko POP! Animation One Piece Katakuri</option>
                    <option value="Minecraft">Minecraft</option>
                    <option value="Far Cry 5">Far Cry 5</option>
                    <option value="Grand Theft Auto V">Grand Theft Auto V</option>
                    <option value="God of War">God of War</option>
                    <option value="Mortal Kombat X">Mortal Kombat X</option>
                </select>
                
            </div>
            <div class="count2">
                <textarea name="user_message" maxlength="150" placeholder="Введите ваше дополнение" rows="5" required></textarea>
                
            </div>   
            <button type="submit">Отправить</button>
        </form>
        
    </div>
    

    <script>
        var bal = 20000
        var s0 = "Баланс: "
        var s = " рублей"
        document.getElementById("bal").innerHTML = s0 + bal + s
        document.getElementById('message-form').addEventListener('submit', function(event) {
            event.preventDefault();

            var sum = 0

            

            if(this.tovar.value == "-- Выберите товар --"){
                alert('Выберите товар для заказа')
                window.location.reload()
            }

            if(this.tovar.value == "Nintendo Switch Lite"){
                sum = 12000
                if(bal>sum){
                    bal = bal - sum
                    document.getElementById("bal").innerHTML = s0 + bal + s
                }
                else{
                    alert('У вас не достаточно средств, пополните баланс')
                    window.location.reload()
                }
                
            }
            else if(this.tovar.value == "PlayStation 5 Slim"){
                sum = 52000
                if(bal>sum){
                    bal = bal - sum
                    document.getElementById("bal").innerHTML = s0 + bal + s
                }
                else{
                    alert('У вас не достаточно средств, пополните баланс')
                    window.location.reload()
                }
            }
            else if(this.tovar.value == "PlayStation 4 Pro"){
                sum = 39000
                if(bal>sum){
                    bal = bal - sum
                    document.getElementById("bal").innerHTML = s0 + bal + s
                }
                else{
                    alert('У вас не достаточно средств, пополните баланс')
                    window.location.reload()
                }
            }
            else if(this.tovar.value == "Фигурку Funko POP! Disney Donald Duck"){
                sum = 2400
                if(bal>sum){
                    bal = bal - sum
                    document.getElementById("bal").innerHTML = s0 + bal + s
                }
                else{
                    alert('У вас не достаточно средств, пополните баланс')
                    window.location.reload()
                }
            }
            else if(this.tovar.value == "Фигурку Funko POP! TV Invincible Omni-Man"){
                sum = 2100
                if(bal>sum){
                    bal = bal - sum
                    document.getElementById("bal").innerHTML = s0 + bal + s
                }
                else{
                    alert('У вас не достаточно средств, пополните баланс')
                    window.location.reload()
                }
            }
            else if(this.tovar.value == "Фигурку Funko POP! Animation One Piece Katakuri"){
                sum = 2900
                if(bal>sum){
                    bal = bal - sum
                    document.getElementById("bal").innerHTML = s0 + bal + s
                }
                else{
                    alert('У вас не достаточно средств, пополните баланс')
                    window.location.reload()
                }
            }
            else if(this.tovar.value == "Minecraft"){
                sum = 1200
                if(bal>sum){
                    bal = bal - sum
                    document.getElementById("bal").innerHTML = s0 + bal + s
                }
                else{
                    alert('У вас не достаточно средств, пополните баланс')
                    window.location.reload()
                }
            }
            else if(this.tovar.value == "Far Cry 5"){
                sum = 2000
                if(bal>sum){
                    bal = bal - sum
                    document.getElementById("bal").innerHTML = s0 + bal + s
                }
                else{
                    alert('У вас не достаточно средств, пополните баланс')
                    window.location.reload()
                }
            }
            else if(this.tovar.value == "Grand Theft Auto V"){
                sum = 2250
                if(bal>sum){
                    bal = bal - sum
                    document.getElementById("bal").innerHTML = s0 + bal + s
                }
                else{
                    alert('У вас не достаточно средств, пополните баланс')
                    window.location.reload()
                }
            }
            else if(this.tovar.value == "God of War"){
                sum = 1700
                if(bal>sum){
                    bal = bal - sum
                    document.getElementById("bal").innerHTML = s0 + bal + s
                }
                else{
                    alert('У вас не достаточно средств, пополните баланс')
                    window.location.reload()
                }
            }
            else if(this.tovar.value == "Mortal Kombat X"){
                sum = 1800
                if(bal>sum){
                    bal = bal - sum
                    document.getElementById("bal").innerHTML = s0 + bal + s
                }
                else{
                    alert('У вас не достаточно средств, пополните баланс')
                    window.location.reload()
                }
            }
            emailjs.send('service_cf4u9vq', 'template_nr71lop', {
                message: this.user_message.value, // Отправляем введенный текст
                tovar: this.tovar.value,
                tovar_name: this.name.value,
                email: this.email.value,
                tel: this.tel.value,
                sum: sum.toString()
            })
            .then(function() {
                alert('Заказ успешно оформлен!');
            }, function(error) {
                alert('Ошибка при оформлении заказа: ' + JSON.stringify(error));
            });
        });
    </script>
</body>
</html>